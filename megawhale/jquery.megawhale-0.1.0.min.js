/* https://github.com/registerguard/jquery-megawhale */;(function($){var touch=(("ontouchstart" in window)||(window.DocumentTouch&&document instanceof DocumentTouch)),constants={C:((typeof console!=="undefined")?true:false),NS:"megawhale",PREFIX:"mw",TOUCH:touch,TYPE:(touch?"touchstart":"click")},methods={init:function(opts){return this.each(function(){var $this=$(this),data=$this.data(constants.NS),options=$.extend({},settings.external,$.fn[constants.NS].defaults,opts);if(!data){var $divs=$this.children("li").children("div"),$lis=$divs.parent("li"),$hrefs=$lis.children("a");$this.data(constants.NS,{divs:$divs,hrefs:$hrefs,init:false,lis:$lis,options:options,outside:false,target:$this});data=$this.data(constants.NS);}if(!data.init){data.init=true;options.onInit.call($this);if(($divs.length===$hrefs.length)){$this.addClass(settings.internal.menuClass);$divs.hide();options.eventType=(/^(?:click|hover|hoverIntent)$/).test(options.eventType)?options.eventType:"hover";if(options.arrow){$hrefs.addClass(settings.internal.anchorClass).append(options.arrow);}if(((options.eventType==="click")||constants.TOUCH)&&options.close){$(options.close).appendTo($divs).on(constants.TYPE+"."+constants.NS,function(e){var $li=$(this).parent("div").parent("li");methods.close.call($li);e.preventDefault();e.stopPropagation();});}$hrefs.on("mousedown."+constants.NS+" mouseup."+constants.NS+" focus."+constants.NS,function(e){var $$=$(this),$li=$$.parent("li");switch(e.type){case"mousedown":$li.data(constants.NS+".mousedown",true);break;case"mouseup":$li.removeData(constants.NS+".mousedown");break;case"focus":if(!$li.data(constants.NS+".mousedown")){if(constants.TOUCH||(options.eventType==="click")){$$.click();}else{if(options.eventOutside){startOutside(data);}methods.open.call($li);}}break;}e.preventDefault();e.stopPropagation();});if(constants.TOUCH||(options.eventType==="click")){$hrefs.on(constants.TYPE+"."+constants.NS,function(e){var $$=$(this),$li=$$.parent("li");if($$.hasClass(settings.internal.clickClass)){if(options.eventOutside){endOutside(data);}methods.close.call($li);var uri=getUri.call($$);if(uri){window.location=uri;}}else{if(options.eventOutside){startOutside(data);}$hrefs.removeClass(settings.internal.clickClass);$$.addClass(settings.internal.clickClass);methods.open.call($li);}e.preventDefault();e.stopPropagation();});}else{$lis.on("mouseenter."+constants.NS+" mouseleave."+constants.NS,function(e){var $$=$(this);switch(e.type){case"mouseenter":if(options.eventOutside){endOutside(data);}$.fn[constants.NS].hoverEnter.call($$);break;case"mouseleave":$.fn[constants.NS].hoverLeave.call($$);break;}});}options.onAfterInit.call($this);}else{if(constants.C){console.warn("there was a problem with your markup");}return this;}}else{if(constants.C){console.warn(constants.NS,"already initialized on",this);}return this;}});},open:function($elem){if(typeof $elem==="undefined"){$elem=this;}return $elem.each(function(){var $$=$(this),data=$$.parent().data(constants.NS),options=data.options;if(!$$.hasClass(options.openClass)){var $div=$$.children("div");$$.addClass(options.openClass).siblings().removeClass(options.openClass).children("div").stop(true).hide().css("visibility","hidden");$div.filter(":hidden").css("visibility","visible");options.onBeforeShow.call($div);$div.animate(options.animIn,options.speedIn,options.easeIn,function(){options.onShow.call($div);});}});},close:function($elem){if(typeof $elem==="undefined"){$elem=this;}return $elem.each(function(){var $$=$(this),data=$$.parent().data(constants.NS),options=data.options;if($$.hasClass(options.openClass)){var $div=$$.children("div");$$.children("a").removeClass(settings.internal.clickClass).blur();options.onBeforeHide.call($div);$div.animate(options.animOut,options.speedOut,options.easeOut,function(){$(this).hide().css("visibility","hidden").parent().removeClass(options.openClass);options.onHide.call($div);});}});},destroy:function(){return this.each(function(){var $$=$(this),data=$$.data(constants.NS);if(data){var options=data.options;data.divs.removeAttr("style");if(((options.eventType==="click")||constants.TOUCH)&&options.close){data.divs.find("."+settings.internal.closeClass).remove();}data.hrefs.off("."+constants.NS);if(options.arrow){data.hrefs.removeClass(settings.internal.anchorClass).find("."+settings.internal.arrowClass).remove();}data.hrefs.removeClass(settings.internal.clickClass);data.lis.removeData(constants.NS+".mousedown").off("."+constants.NS);data.target.removeClass(settings.internal.menuClass);$$.removeData(constants.NS);}else{if(constants.C){console.warn(constants.NS,"already initialized on",this);}}});}},startOutside=function(data){if(!data.outside){data.outside=true;data.options.onStartOutside.call(data.target);var $$=$(document);$$.off("."+constants.NS);$$.on("focusin."+constants.NS+" "+constants.TYPE+"."+constants.NS,function(e){if($(e.target).closest(data.target).length===0){endOutside(data);methods.close.call(data.lis);}else{return true;}});}},endOutside=function(data){if(data.outside){data.options.onEndOutside.call(data.target);data.outside=false;$(document).off("."+constants.NS);}},getUri=function(){var uri=this.attr("href");return(uri&&(uri!=="#"))?uri:false;};$.fn[constants.NS]=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else{if((typeof method==="object")||(!method)){return methods.init.apply(this,arguments);}else{$.error("Method "+method+" does not exist on jQuery."+constants.NS);}}};$.fn[constants.NS].hoverEnter=function(){return this.each(function(){var $$=$(this),data=$$.parent().data(constants.NS),options=data.options;if((!$.fn.doTimeout)||(options.eventType!=="hoverIntent")){methods.open.call($$);}else{$$.doTimeout("hover",options.delayIn,function(){methods.open.call($(this));});}});};$.fn[constants.NS].hoverLeave=function(){return this.each(function(){var $$=$(this),data=$$.parent().data(constants.NS),options=data.options;if((!$.fn.doTimeout)||(options.eventType!=="hoverIntent")){methods.close.call($$);}else{$$.doTimeout("hover",options.delayOut,function(){methods.close.call($(this));});}});};var settings={};settings.internal={anchorClass:constants.PREFIX+"-a-with-div",arrowClass:constants.PREFIX+"-arrow",clickClass:constants.PREFIX+"-a-clicked",closeClass:constants.PREFIX+"-close",menuClass:constants.PREFIX+"-js-enabled"};settings.external={animIn:{opacity:"show"},animOut:{opacity:"hide"},arrow:'<span class="'+settings.internal.arrowClass+'">&#187;</span>',close:'<span class="'+settings.internal.closeClass+'">(X)</span>',delayIn:400,delayOut:700,easeIn:"swing",easeOut:"swing",eventOutside:true,eventType:"hover",openClass:constants.PREFIX+"-open",speedIn:"normal",speedOut:"normal",onInit:function(){},onAfterInit:function(){},onBeforeShow:function(){},onShow:function(){},onBeforeHide:function(){},onHide:function(){},onStartOutside:function(){},onEndOutside:function(){}};$.fn[constants.NS].defaults=settings.external;})(jQuery);